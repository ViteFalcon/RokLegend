# Macro to link target libraries given a RokLegend module.
MACRO(RO_TARGET_LINK_LIBRARIES TARGET)
    SET(MODULE_LIBS "")
    FOREACH(LIB_NAME ${ARGN})
        TARGET_LINK_LIBRARIES(
            ${TARGET}
            debug ${ROKLEGEND_LIB_DIR_DBG}/${LIB_NAME}_d.lib
            optimized ${ROKLEGEND_LIB_DIR_REL}/${LIB_NAME}.lib
        )
    ENDFOREACH()
ENDMACRO()

MACRO(RO_IS_HEADER FILENAME OUTPUT_VAR)
	SET(HEADER_EXTENSIONS ".h" ".hpp" ".hxx")
	GET_FILENAME_COMPONENT(FILE_EXT ${FILENAME} EXT)
	SET(${OUTPUT_VAR} FALSE)
	FOREACH (HEADER_EXT ${HEADER_EXTENSIONS})
		IF ("${FILE_EXT}" STREQUAL "${HEADER_EXT}")
			SET(${OUTPUT_VAR} TRUE)
		ENDIF ()
	ENDFOREACH ()
ENDMACRO()

MACRO(RO_IS_SOURCE FILENAME OUTPUT_VAR)
	SET(SOURCE_EXTENSIONS ".cpp" ".c" ".cxx")
	SET(${OUTPUT_VAR} FALSE)
	GET_FILENAME_COMPONENT(FILE_EXT ${FILENAME} EXT)
	SET(${OUTPUT_VAR} FALSE)
	FOREACH (SOURCE_EXT ${SOURCE_EXTENSIONS})
		IF ("${FILE_EXT}" STREQUAL "${SOURCE_EXT}")
			SET(${OUTPUT_VAR} TRUE)
		ENDIF ()
	ENDFOREACH ()
ENDMACRO()

# Macro to set source-group for a list of files
MACRO(RO_SOURCE_GROUP GROUP_NAME)
    SET(HEADER_FILES "")
    SET(SOURCE_FILES "")
	SET(OTHER_FILES "")
    FOREACH(CXX_FILE ${ARGN})
		RO_IS_HEADER(${CXX_FILE} IS_HEADER)
		RO_IS_SOURCE(${CXX_FILE} IS_SOURCE)
		IF (${IS_HEADER})
			LIST(APPEND HEADER_FILES ${CXX_FILE})
		ELSEIF (${IS_SOURCE})
			LIST(APPEND SOURCE_FILES ${CXX_FILE})
		ELSE ()
			MESSAGE("-- Group: ${GROUP_NAME}; File: ${CXX_FILE}")
			LIST(APPEND OTHER_FILES ${CXX_FILE})
		ENDIF ()
    ENDFOREACH()
    SOURCE_GROUP(${ROKLEGEND_HXX_SOURCE_GROUP}\\${GROUP_NAME} FILES ${HEADER_FILES})
    SOURCE_GROUP(${ROKLEGEND_CXX_SOURCE_GROUP}\\${GROUP_NAME} FILES ${SOURCE_FILES})
	SOURCE_GROUP(${GROUP_NAME} FILES ${OTHER_FILES})
ENDMACRO()

MACRO(RO_TARGET_ENABLE_AVX2 TARGET_NAME)
	MESSAGE("--- Adding AVX2 to ${TARGET_NAME}")
	TARGET_COMPILE_OPTIONS(${TARGET_NAME} PRIVATE /arch:AVX2)
ENDMACRO()